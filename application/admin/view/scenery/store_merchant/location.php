{extend name="public/container"}{block name="head_top"}<link href="{__ADMIN_PATH}plug/umeditor/themes/default/css/umeditor.css" type="text/css" rel="stylesheet"><link href="{__ADMIN_PATH}module/wechat/news/css/style.css" type="text/css" rel="stylesheet"><link href="{__FRAME_PATH}css/plugins/chosen/chosen.css" rel="stylesheet"><script type="text/javascript" src="{__ADMIN_PATH}plug/umeditor/third-party/jquery.min.js"></script><script type="text/javascript" src="{__ADMIN_PATH}plug/umeditor/third-party/template.min.js"></script><script type="text/javascript" charset="utf-8" src="{__ADMIN_PATH}plug/umeditor/umeditor.config.js"></script><script type="text/javascript" charset="utf-8" src="{__ADMIN_PATH}plug/umeditor/umeditor.min.js"></script><script src="{__ADMIN_PATH}frame/js/ajaxfileupload.js"></script><script src="{__ADMIN_PATH}plug/validate/jquery.validate.js"></script><script src="{__FRAME_PATH}js/plugins/chosen/chosen.jquery.js"></script><link rel="stylesheet" href="http://cache.amap.com/lbs/static/main1119.css"/><script type="text/javascript" src="http://webapi.amap.com/maps?v=1.3&key=ba26416230b6a8afe564133920c87a4a"></script>{/block}{block name="content"}<div class="row" style="width: 100%">   <div class="col-sm-12">       <div class="col-sm-12 panel panel-default" >               <div class="panel-body">                   <div id="container" style="height: 600px"></div>                   <div id="myPageTop">                       <table>                           <tr>                               <td>点击地图，即可获得经纬度坐标</td>                               <td>                                   <div class="detail">                                       <p>                                           <span id="lng"> </span>  &nbsp;&nbsp;                                           <span id="lat"> </span>                                       </p>                                       <p>                                           <span id="iAddress"> </span>                                           <input type="hidden" id="area"/>                                       </p>                                   </div>                               </td>                           </tr>                           <tr>                               <td>                                   <label>按关键字搜索：</label>                                   <input type="text" placeholder="请输入关键字进行搜索" id="tipinput">                                   <input type="hidden" name="e" id="e">                               </td>                               <td class="column2">                                   <button onclick="push()">确定</button>                               </td>                           </tr>                       </table>                   </div>                   <div class="info">                   </div>               </div>       </div>   </div></div>{/block}{block name="script"}<script>    var mapObj;    var lnglatXY;    //初始化地图    function mapInit() {        var opt = {            level: 13, //设置地图缩放级别        }        mapObj = new AMap.Map("container", opt);        AMap.event.addListener(mapObj, 'click', getLnglat); //点击事件        mapObj.plugin(["AMap.Autocomplete"], function () {            var auto = new AMap.Autocomplete({                input: "tipinput"            });            AMap.event.addListener(auto, "select", select);//注册监听，当选中某条记录时会触发            function select(e) {                if (e.poi && e.poi.location) {                    mapObj.setZoom(15);                    mapObj.setCenter(e.poi.location);                }            }        });    }    function geocoder() {        var MGeocoder;        //加载地理编码插件        mapObj.plugin(['AMap.ToolBar','AMap.Scale','AMap.OverView','AMap.MapType','AMap.Geolocation','AMap.Autocomplete'],            function(){                mapObj.addControl(new AMap.ToolBar());                mapObj.addControl(new AMap.Scale());                mapObj.addControl(new AMap.OverView({isOpen:true}));                mapObj.addControl(new AMap.MapType());                mapObj.addControl(new AMap.Geolocation());                mapObj.addControl(new AMap.Autocomplete());            });        mapObj.plugin(["AMap.Geocoder"], function () {            MGeocoder = new AMap.Geocoder({                radius: 1000,                extensions: "all"            });            //返回地理编码结果            AMap.event.addListener(MGeocoder, "complete", geocoder_CallBack);            //逆地理编码            MGeocoder.getAddress(lnglatXY);        });        //加点        var marker = new AMap.Marker({            map: mapObj,            icon: new AMap.Icon({                image: "https://webapi.amap.com/theme/v1.3/markers/n/mark_bs.png" ,                size: new AMap.Size(58, 30),                imageOffset: new AMap.Pixel(-0, -0)            }),            position: lnglatXY,            offset: new AMap.Pixel(-5, -30)        });        // mapObj.setFitView();    }    //回调函数    function geocoder_CallBack(data) {        var address;        //返回地址描述        address = data.regeocode.formattedAddress;        //返回结果拼接输出        $("#iAddress").html(address);        $("#area").val(data.regeocode.addressComponent.province+data.regeocode.addressComponent.city+data.regeocode.addressComponent.district);    }    //鼠标点击，获取经纬度坐标    function getLnglat(e) {        mapObj.clearMap();        var x = e.lnglat.getLng();        var y = e.lnglat.getLat();        $("#lng").html(x);        $("#lat").html(y);        lnglatXY = new AMap.LngLat(x, y);        geocoder();    }    //地理位置信息回填    function push(){        var index = parent.layer.getFrameIndex(window.name); //获取窗口索引        parent.$('#store_address').val($("#iAddress").html());        parent.$('#lng').val($("#lng").html());        parent.$('#lat').val($("#lat").html());        parent.layer.close(index);    }    mapInit();</script>{/block}